# LMArena ä½¿ç”¨æŒ‡å— ğŸ“–

## ç›®å½•
1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
3. [API æ¥å£è¯´æ˜](#api-æ¥å£è¯´æ˜)
4. [é…ç½®è¯¦è§£](#é…ç½®è¯¦è§£)
5. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- pip åŒ…ç®¡ç†å™¨
- OpenAI API Key æˆ–å…¼å®¹çš„ API

### å®‰è£…æ­¥éª¤

1. **å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®åˆ°æœ¬åœ°**

2. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **é…ç½®ç¯å¢ƒå˜é‡**

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä» `.env.example` å¤åˆ¶ï¼‰ï¼š
```bash
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1
DATABASE_URL=sqlite+aiosqlite:///./lmarena.db
```

4. **è¿è¡Œåº”ç”¨**
```bash
python main.py
```

5. **è®¿é—®åº”ç”¨**
- æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8000
- API æ–‡æ¡£: http://localhost:8000/docs

---

## åŠŸèƒ½è¯¦è§£

### 1ï¸âƒ£ åŒ¿åå¯¹æˆ˜æ¨¡å¼ (Battle Mode)

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- éšæœºé€‰æ‹©ä¸¤ä¸ªæ¨¡å‹ï¼ŒåŒ¿åè¿›è¡Œå¯¹æˆ˜
- ç”¨æˆ·æ ¹æ®å›ç­”è´¨é‡æŠ•ç¥¨
- æŠ•ç¥¨åæ­ç¤ºæ¨¡å‹èº«ä»½
- è‡ªåŠ¨æ›´æ–° ELO è¯„åˆ†å’Œæ’è¡Œæ¦œ

**ä½¿ç”¨æµç¨‹ï¼š**
1. ç‚¹å‡»"å¼€å§‹å¯¹æˆ˜"æŒ‰é’®
2. ç³»ç»Ÿéšæœºé€‰æ‹©ä¸¤ä¸ªæ¨¡å‹ï¼ˆä½ ä¸çŸ¥é“å®ƒä»¬æ˜¯è°ï¼‰
3. è¾“å…¥ä½ çš„é—®é¢˜
4. ä¸¤ä¸ªæ¨¡å‹åŒæ—¶å›ç­”
5. æŸ¥çœ‹å›ç­”ï¼Œé€‰æ‹©æ›´å¥½çš„é‚£ä¸ªï¼ˆæˆ–é€‰æ‹©å¹³å±€ï¼‰
6. æŠ•ç¥¨åæ­ç¤ºæ¨¡å‹èº«ä»½
7. æ’è¡Œæ¦œè‡ªåŠ¨æ›´æ–°

**æœ€ä½³å®è·µï¼š**
- æå‡ºæœ‰æ·±åº¦çš„é—®é¢˜ï¼Œæ›´èƒ½åŒºåˆ†æ¨¡å‹èƒ½åŠ›
- ä»å¤šä¸ªç»´åº¦è¯„ä¼°ï¼ˆå‡†ç¡®æ€§ã€åˆ›é€ æ€§ã€æ ¼å¼ç­‰ï¼‰
- é¿å…å¤ªç®€å•æˆ–å¤ªä¸»è§‚çš„é—®é¢˜

### 2ï¸âƒ£ å¹¶æ’å¯¹æ¯”æ¨¡å¼ (Side-by-Side)

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- æ‰‹åŠ¨é€‰æ‹©è¦å¯¹æ¯”çš„ä¸¤ä¸ªæ¨¡å‹
- å®æ—¶æŸ¥çœ‹ä¸¤ä¸ªæ¨¡å‹çš„å›ç­”å·®å¼‚
- æ•°æ®ç”¨äºç ”ç©¶ï¼Œä¸è®¡å…¥æ’è¡Œæ¦œ

**ä½¿ç”¨åœºæ™¯ï¼š**
- ç ”ç©¶ç‰¹å®šæ¨¡å‹çš„å·®å¼‚
- æµ‹è¯•æ¨¡å‹åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„è¡¨ç°
- è¿›è¡Œæ¨¡å‹èƒ½åŠ›åˆ†æ

**ä½¿ç”¨æµç¨‹ï¼š**
1. é€‰æ‹©æ¨¡å‹ A å’Œæ¨¡å‹ B
2. è¾“å…¥é—®é¢˜
3. ä¸¤ä¸ªæ¨¡å‹åŒæ—¶å›ç­”
4. å¯¹æ¯”æŸ¥çœ‹ç»“æœ
5. ç»§ç»­å¯¹è¯æˆ–æ›´æ¢æ¨¡å‹

### 3ï¸âƒ£ ç›´æ¥å¯¹è¯æ¨¡å¼ (Direct Chat)

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- ä¸å•ä¸ªæ¨¡å‹è¿›è¡Œå¯¹è¯
- é€‚åˆæ·±å…¥ä½“éªŒæŸä¸ªæ¨¡å‹
- æ”¯æŒå¤šè½®å¯¹è¯

**ä½¿ç”¨åœºæ™¯ï¼š**
- ç†Ÿæ‚‰æŸä¸ªæ¨¡å‹çš„ç‰¹ç‚¹
- è¿›è¡Œæ·±åº¦å¯¹è¯
- æµ‹è¯•ç‰¹å®šåœºæ™¯

**ä½¿ç”¨æµç¨‹ï¼š**
1. é€‰æ‹©ä¸€ä¸ªæ¨¡å‹
2. å¼€å§‹å¯¹è¯
3. æ”¯æŒè¿ç»­å¤šè½®äº¤äº’

### 4ï¸âƒ£ æ’è¡Œæ¦œ (Leaderboard)

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- åŸºäº ELO è¯„åˆ†ç³»ç»Ÿ
- å®æ—¶æ›´æ–°
- æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡æ•°æ®

**æ•°æ®æŒ‡æ ‡ï¼š**
- **è¯„åˆ† (Rating)**: ELO åˆ†æ•°ï¼Œåˆå§‹ 1500
- **å¯¹æˆ˜æ•° (Battles)**: å‚ä¸çš„æ€»å¯¹æˆ˜æ¬¡æ•°
- **èƒœç‡ (Win Rate)**: è·èƒœçš„ç™¾åˆ†æ¯”
- **èƒœ/è´Ÿ/å¹³**: è¯¦ç»†æˆ˜ç»©ç»Ÿè®¡

**ELO è¯„åˆ†è¯´æ˜ï¼š**
- å‡»è´¥é«˜åˆ†æ¨¡å‹è·å¾—æ›´å¤šåˆ†æ•°
- è¾“ç»™ä½åˆ†æ¨¡å‹å¤±å»æ›´å¤šåˆ†æ•°
- å¹³å±€åŒæ–¹åˆ†æ•°å˜åŒ–è¾ƒå°
- K å› å­é»˜è®¤ä¸º 32ï¼Œæ§åˆ¶åˆ†æ•°æ³¢åŠ¨å¹…åº¦

---

## API æ¥å£è¯´æ˜

### Battle API

#### 1. å¼€å§‹å¯¹æˆ˜
```http
POST /api/battle/start
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "session_id": "uuid-string",
  "message": "å¯¹æˆ˜å¼€å§‹ï¼è¯·è¾“å…¥ä½ çš„é—®é¢˜..."
}
```

#### 2. å‘é€æ¶ˆæ¯
```http
POST /api/battle/chat
Content-Type: application/json

{
  "session_id": "uuid-string",
  "message": "ä½ çš„é—®é¢˜"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "session_id": "uuid-string",
  "response_a": "æ¨¡å‹ A çš„å›ç­”",
  "response_b": "æ¨¡å‹ B çš„å›ç­”"
}
```

#### 3. æäº¤æŠ•ç¥¨
```http
POST /api/battle/vote
Content-Type: application/json

{
  "session_id": "uuid-string",
  "winner": "model_a"  // æˆ– "model_b" æˆ– "tie"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æŠ•ç¥¨æˆåŠŸï¼",
  "model_a_id": "gpt-4",
  "model_a_name": "GPT-4",
  "model_b_id": "gpt-3.5-turbo",
  "model_b_name": "GPT-3.5 Turbo",
  "new_rating_a": 1516.5,
  "new_rating_b": 1483.5
}
```

### Chat API

#### 1. è·å–å¯ç”¨æ¨¡å‹
```http
GET /api/chat/models
```

#### 2. ç›´æ¥å¯¹è¯
```http
POST /api/chat/direct
Content-Type: application/json

{
  "model_id": "gpt-4",
  "message": "ä½ çš„é—®é¢˜",
  "session_id": "uuid-string"  // å¯é€‰ï¼Œç”¨äºç»§ç»­å¯¹è¯
}
```

#### 3. å¹¶æ’å¯¹æ¯”
```http
POST /api/chat/sidebyside
Content-Type: application/json

{
  "model_a_id": "gpt-4",
  "model_b_id": "gpt-3.5-turbo",
  "message": "ä½ çš„é—®é¢˜",
  "session_id": "uuid-string"  // å¯é€‰
}
```

### Leaderboard API

#### è·å–æ’è¡Œæ¦œ
```http
GET /api/leaderboard?limit=50
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "leaderboard": [
    {
      "rank": 1,
      "model_id": "gpt-4",
      "model_name": "GPT-4",
      "rating": 1520.5,
      "total_battles": 100,
      "wins": 60,
      "losses": 30,
      "ties": 10,
      "win_rate": 60.0
    }
  ],
  "total_models": 5
}
```

---

## é…ç½®è¯¦è§£

### config.py é…ç½®é¡¹

#### 1. æ¨¡å‹é…ç½®
```python
AVAILABLE_MODELS = [
    {
        "id": "gpt-4-turbo-preview",  # æ¨¡å‹ IDï¼ˆè°ƒç”¨ API æ—¶ä½¿ç”¨ï¼‰
        "name": "GPT-4 Turbo",         # æ˜¾ç¤ºåç§°
        "provider": "openai",           # æä¾›å•†
        "initial_rating": 1500          # åˆå§‹è¯„åˆ†
    }
]
```

#### 2. ELO è¯„åˆ†å‚æ•°
```python
ELO_K_FACTOR = 32      # K å› å­ï¼Œè¶Šå¤§åˆ†æ•°æ³¢åŠ¨è¶Šå¤§
INITIAL_RATING = 1500  # åˆå§‹è¯„åˆ†
```

**K å› å­è¯´æ˜ï¼š**
- 8-16: é€‚åˆæˆç†Ÿç³»ç»Ÿï¼Œåˆ†æ•°å˜åŒ–ç¼“æ…¢
- 32: é»˜è®¤å€¼ï¼Œé€‚åˆæ–°ç³»ç»Ÿ
- 40-64: åˆ†æ•°å˜åŒ–å¿«ï¼Œé€‚åˆå¿«é€Ÿæµ‹è¯•

### ç¯å¢ƒå˜é‡é…ç½®

#### .env æ–‡ä»¶
```bash
# OpenAI API é…ç½®
OPENAI_API_KEY=sk-your-key-here
OPENAI_BASE_URL=https://api.openai.com/v1

# æ•°æ®åº“é…ç½®ï¼ˆå¯é€‰ï¼‰
DATABASE_URL=sqlite+aiosqlite:///./lmarena.db

# ä½¿ç”¨ PostgreSQLï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
# DATABASE_URL=postgresql+asyncpg://user:password@localhost/lmarena
```

### ä½¿ç”¨å…¶ä»– API æä¾›å•†

#### Azure OpenAI
```bash
OPENAI_API_KEY=your-azure-key
OPENAI_BASE_URL=https://your-resource.openai.azure.com/openai/deployments/your-deployment
```

#### æœ¬åœ°æ¨¡å‹ï¼ˆå¦‚ Ollamaã€LM Studioï¼‰
```bash
OPENAI_API_KEY=not-needed
OPENAI_BASE_URL=http://localhost:11434/v1
```

---

## éƒ¨ç½²æŒ‡å—

### ä½¿ç”¨ Docker éƒ¨ç½²

1. **åˆ›å»º Dockerfile**
```dockerfile
FROM python:3.10-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "main.py"]
```

2. **æ„å»ºé•œåƒ**
```bash
docker build -t lmarena .
```

3. **è¿è¡Œå®¹å™¨**
```bash
docker run -p 8000:8000 --env-file .env lmarena
```

### ä½¿ç”¨ Nginx åå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **ä½¿ç”¨ PostgreSQL**
```bash
DATABASE_URL=postgresql+asyncpg://user:password@localhost/lmarena
```

2. **ä½¿ç”¨ Gunicorn + Uvicorn Workers**
```bash
pip install gunicorn
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

3. **æ·»åŠ æ—¥å¿—**
```python
import logging
logging.basicConfig(level=logging.INFO)
```

---

## å¸¸è§é—®é¢˜ FAQ

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ¨¡å‹ï¼Ÿ
A: ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œåœ¨ `AVAILABLE_MODELS` åˆ—è¡¨ä¸­æ·»åŠ æ–°æ¨¡å‹é…ç½®ã€‚

### Q: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
A: é»˜è®¤ä½¿ç”¨ SQLiteï¼Œæ•°æ®åº“æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `lmarena.db`ã€‚

### Q: å¦‚ä½•é‡ç½®æ‰€æœ‰æ•°æ®ï¼Ÿ
A: åˆ é™¤ `lmarena.db` æ–‡ä»¶ï¼Œé‡å¯åº”ç”¨å³å¯ã€‚

### Q: æ”¯æŒå“ªäº›æ¨¡å‹ï¼Ÿ
A: æ”¯æŒæ‰€æœ‰å…¼å®¹ OpenAI API æ ¼å¼çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ GPT ç³»åˆ—ã€Claudeï¼ˆé€šè¿‡ä»£ç†ï¼‰ã€æœ¬åœ°æ¨¡å‹ç­‰ã€‚

### Q: ELO è¯„åˆ†å¦‚ä½•è®¡ç®—ï¼Ÿ
A: ä½¿ç”¨æ ‡å‡† ELO ç®—æ³•ï¼ŒåŸºäºå¯¹æˆ˜ç»“æœå’ŒåŒæ–¹è¯„åˆ†å·®å¼‚è®¡ç®—åˆ†æ•°å˜åŒ–ã€‚

### Q: å¯ä»¥å¯¼å‡ºæ•°æ®å—ï¼Ÿ
A: å¯ä»¥ç›´æ¥è®¿é—® SQLite æ•°æ®åº“ï¼Œæˆ–é€šè¿‡ API è·å–æ•°æ®ã€‚

---

## æŠ€æœ¯æ¶æ„

```
Frontend (æµè§ˆå™¨)
    â†“
FastAPI (REST API)
    â†“
Services Layer
    â”œâ”€â”€ ModelService (AI è°ƒç”¨)
    â””â”€â”€ RatingService (ELO è®¡ç®—)
    â†“
Database (SQLite/PostgreSQL)
```

---

## è®¸å¯è¯

MIT License - è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘

---

**äº«å—ä½ çš„ AI æ¨¡å‹å¯¹æˆ˜ä¹‹æ—…ï¼** ğŸš€

