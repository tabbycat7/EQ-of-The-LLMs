# ğŸ”§ æ•…éšœæ’é™¤æŒ‡å—

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. å®‰è£…é—®é¢˜

#### âŒ é—®é¢˜: `pip install` å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- ç½‘ç»œé—®é¢˜
- Python ç‰ˆæœ¬ä¸å…¼å®¹
- æƒé™é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å¦‚æœæœ‰æƒé™é—®é¢˜ï¼Œæ·»åŠ  --user
pip install -r requirements.txt --user

# å‡çº§ pip
python -m pip install --upgrade pip
```

#### âŒ é—®é¢˜: æ‰¾ä¸åˆ°æŸä¸ªæ¨¡å—

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# ç¡®è®¤å·²å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt

# æ£€æŸ¥ Python è·¯å¾„
python -c "import sys; print(sys.path)"

# å°è¯•å•ç‹¬å®‰è£…é—®é¢˜æ¨¡å—
pip install fastapi uvicorn openai
```

---

### 2. å¯åŠ¨é—®é¢˜

#### âŒ é—®é¢˜: `ModuleNotFoundError: No module named 'xxx'`

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ç¡®ä¿åœ¨æ­£ç¡®çš„ Python ç¯å¢ƒä¸­è¿è¡Œ
python --version
which python  # Linux/Mac
where python  # Windows
```

#### âŒ é—®é¢˜: ç«¯å£ 8000 å·²è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```
ERROR: [Errno 48] Address already in use
```

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ³• 1: æ›´æ”¹ç«¯å£**
```bash
# ä½¿ç”¨ä¸åŒçš„ç«¯å£
uvicorn main:app --port 8001
```

**æ–¹æ³• 2: å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹**
```bash
# Windows
netstat -ano | findstr :8000
taskkill /PID <PID> /F

# Linux/Mac
lsof -ti:8000 | xargs kill -9
```

#### âŒ é—®é¢˜: æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
sqlite3.OperationalError: unable to open database file
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# ç¡®ä¿æœ‰å†™å…¥æƒé™
chmod 755 .  # Linux/Mac

# åˆ é™¤æ—§æ•°æ®åº“æ–‡ä»¶é‡æ–°åˆ›å»º
rm lmarena.db  # Linux/Mac
del lmarena.db  # Windows

# é‡å¯åº”ç”¨
python main.py
```

---

### 3. API è°ƒç”¨é—®é¢˜

#### âŒ é—®é¢˜: OpenAI API è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
openai.error.AuthenticationError: Invalid API Key
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ API Key æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿ API Key æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–å¼•å·
3. éªŒè¯ API Key æ˜¯å¦æœ‰æ•ˆï¼š
```bash
# æµ‹è¯• API Key
curl https://api.openai.com/v1/models \
  -H "Authorization: Bearer YOUR_API_KEY"
```

#### âŒ é—®é¢˜: API è¯·æ±‚è¶…æ—¶

**é”™è¯¯ä¿¡æ¯ï¼š**
```
httpx.ReadTimeout: timeout
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆä¿®æ”¹ `services/model_service.py`ï¼‰
3. å¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä»£ç†æˆ– Azure OpenAI

#### âŒ é—®é¢˜: 429 Too Many Requests

**é”™è¯¯ä¿¡æ¯ï¼š**
```
openai.error.RateLimitError: Rate limit exceeded
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç­‰å¾…ä¸€æ®µæ—¶é—´å†è¯•
2. å‡çº§ OpenAI API å¥—é¤
3. åœ¨ `config.py` ä¸­å‡å°‘å¹¶å‘è¯·æ±‚æ•°é‡

---

### 4. å‰ç«¯é—®é¢˜

#### âŒ é—®é¢˜: é¡µé¢æ˜¾ç¤ºå¼‚å¸¸

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰
2. å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼ˆCtrl+F5ï¼‰
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ï¼ˆF12ï¼‰

#### âŒ é—®é¢˜: é™æ€æ–‡ä»¶ 404

**é”™è¯¯ä¿¡æ¯ï¼š**
```
404 Not Found: /static/css/style.css
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ `static/` ç›®å½•ç»“æ„æ­£ç¡®
2. æ£€æŸ¥ `main.py` ä¸­çš„é™æ€æ–‡ä»¶æŒ‚è½½è·¯å¾„
3. é‡å¯åº”ç”¨

#### âŒ é—®é¢˜: JavaScript é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†é”™è¯¯
2. æ£€æŸ¥ `static/js/app.js` è¯­æ³•
3. ç¡®ä¿ API ç«¯ç‚¹æ­£ç¡®

---

### 5. æ•°æ®åº“é—®é¢˜

#### âŒ é—®é¢˜: æ•°æ®åº“é”å®š

**é”™è¯¯ä¿¡æ¯ï¼š**
```
sqlite3.OperationalError: database is locked
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# å…³é—­æ‰€æœ‰è®¿é—®æ•°æ®åº“çš„è¿›ç¨‹
# åˆ é™¤æ•°æ®åº“é”æ–‡ä»¶
rm lmarena.db-journal  # å¦‚æœå­˜åœ¨

# é‡å¯åº”ç”¨
python main.py
```

#### âŒ é—®é¢˜: è¡¨ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```
sqlite3.OperationalError: no such table: battles
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åˆ é™¤æ•°æ®åº“æ–‡ä»¶ï¼Œè®©åº”ç”¨é‡æ–°åˆ›å»º
rm lmarena.db
python main.py
```

#### âŒ é—®é¢˜: è¿ç§»åˆ° PostgreSQL

**æ­¥éª¤ï¼š**
1. å®‰è£… PostgreSQL é©±åŠ¨
```bash
pip install asyncpg
```

2. ä¿®æ”¹ `.env`
```bash
DATABASE_URL=postgresql+asyncpg://user:password@localhost/lmarena
```

3. åˆ›å»ºæ•°æ®åº“
```sql
CREATE DATABASE lmarena;
```

4. é‡å¯åº”ç”¨

---

### 6. æ€§èƒ½é—®é¢˜

#### âŒ é—®é¢˜: å“åº”é€Ÿåº¦æ…¢

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**

1. **ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹**
   - å°† GPT-4 æ”¹ä¸º GPT-3.5-turbo
   - å‡å°‘ max_tokens å‚æ•°

2. **ä¼˜åŒ–æ•°æ®åº“**
```python
# åœ¨ models/schemas.py ä¸­æ·»åŠ ç´¢å¼•
from sqlalchemy import Index

__table_args__ = (
    Index('idx_model_rating', 'rating'),
    Index('idx_battle_created', 'created_at'),
)
```

3. **ä½¿ç”¨ç¼“å­˜**
   - æ·»åŠ  Redis ç¼“å­˜æ’è¡Œæ¦œæ•°æ®
   - ç¼“å­˜æ¨¡å‹åˆ—è¡¨

4. **å¢åŠ å¹¶å‘æ•°**
```bash
# ä½¿ç”¨å¤šä¸ª worker
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker
```

---

### 7. é…ç½®é—®é¢˜

#### âŒ é—®é¢˜: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
2. æ£€æŸ¥æ–‡ä»¶ç¼–ç ï¼ˆåº”ä¸º UTF-8ï¼‰
3. ç¡®ä¿æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼
4. å°è¯•é‡å¯åº”ç”¨

**æ­£ç¡®çš„ .env æ ¼å¼ï¼š**
```bash
# æ­£ç¡® âœ…
OPENAI_API_KEY=sk-xxxxx

# é”™è¯¯ âŒ
OPENAI_API_KEY = sk-xxxxx  # ä¸è¦æœ‰ç©ºæ ¼
OPENAI_API_KEY="sk-xxxxx"  # ä¸è¦åŠ å¼•å·
```

#### âŒ é—®é¢˜: æ¨¡å‹åˆ—è¡¨ä¸ºç©º

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `config.py` ä¸­çš„ `AVAILABLE_MODELS`
2. ç¡®ä¿è‡³å°‘æœ‰ 2 ä¸ªæ¨¡å‹ï¼ˆå¯¹æˆ˜æ¨¡å¼éœ€è¦ï¼‰
3. éªŒè¯æ¨¡å‹ ID æ˜¯å¦æ­£ç¡®

---

### 8. æ—¥å¿—å’Œè°ƒè¯•

#### å¯ç”¨è¯¦ç»†æ—¥å¿—

ä¿®æ”¹ `main.py`ï¼š
```python
import logging

# å¯ç”¨è°ƒè¯•æ—¥å¿—
logging.basicConfig(level=logging.DEBUG)
```

#### æŸ¥çœ‹ API è¯·æ±‚æ—¥å¿—

è®¿é—® FastAPI æ–‡æ¡£ç•Œé¢ï¼š
- http://localhost:8000/docs

#### è°ƒè¯• JavaScript

åœ¨æµè§ˆå™¨ä¸­ï¼š
1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å’Œç½‘ç»œè¯·æ±‚

---

### 9. ç‰¹æ®Šç¯å¢ƒé…ç½®

#### ä½¿ç”¨ Azure OpenAI

ä¿®æ”¹ `.env`ï¼š
```bash
OPENAI_API_KEY=your-azure-key
OPENAI_BASE_URL=https://your-resource.openai.azure.com/openai/deployments/your-deployment-name
```

ä¿®æ”¹ `config.py` ä¸­çš„æ¨¡å‹ IDï¼š
```python
AVAILABLE_MODELS = [
    {
        "id": "your-deployment-name",  # Azure éƒ¨ç½²åç§°
        "name": "GPT-4",
        "provider": "azure",
        "initial_rating": 1500
    }
]
```

#### ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼ˆOllamaï¼‰

1. å¯åŠ¨ Ollama æœåŠ¡
```bash
ollama serve
```

2. ä¿®æ”¹ `.env`ï¼š
```bash
OPENAI_API_KEY=not-needed
OPENAI_BASE_URL=http://localhost:11434/v1
```

3. ä¿®æ”¹ `config.py`ï¼š
```python
AVAILABLE_MODELS = [
    {"id": "llama2", "name": "Llama 2", "provider": "ollama"},
    {"id": "mistral", "name": "Mistral", "provider": "ollama"},
]
```

#### é…ç½®ä»£ç†

å¦‚æœéœ€è¦é€šè¿‡ä»£ç†è®¿é—® OpenAIï¼š

ä¿®æ”¹ `services/model_service.py`ï¼š
```python
from openai import AsyncOpenAI
import httpx

proxies = {
    "http://": "http://proxy.example.com:8080",
    "https://": "http://proxy.example.com:8080",
}

self.client = AsyncOpenAI(
    api_key=config.OPENAI_API_KEY,
    base_url=config.OPENAI_BASE_URL,
    http_client=httpx.AsyncClient(proxies=proxies)
)
```

---

### 10. æµ‹è¯•å’ŒéªŒè¯

#### è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œ
python main.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
python test_api.py
```

#### æ‰‹åŠ¨æµ‹è¯• API

ä½¿ç”¨ curlï¼š
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æµ‹è¯•è·å–æ¨¡å‹åˆ—è¡¨
curl http://localhost:8000/api/chat/models

# æµ‹è¯•æ’è¡Œæ¦œ
curl http://localhost:8000/api/leaderboard
```

ä½¿ç”¨ Pythonï¼š
```python
import requests

# å¼€å§‹å¯¹æˆ˜
response = requests.post("http://localhost:8000/api/battle/start")
print(response.json())
```

---

## è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—è¾“å‡º**
   - åº”ç”¨å¯åŠ¨æ—¶çš„å®Œæ•´æ—¥å¿—
   - é”™è¯¯å‘ç”Ÿæ—¶çš„å †æ ˆè·Ÿè¸ª

2. **æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ**
   - Python ç‰ˆæœ¬
   - æ“ä½œç³»ç»Ÿç‰ˆæœ¬
   - ä¾èµ–åŒ…ç‰ˆæœ¬

3. **æœ€å°åŒ–å¤ç°**
   - å°è¯•æœ€ç®€å•çš„æµ‹è¯•ç”¨ä¾‹
   - æ’é™¤å…¶ä»–å› ç´ å¹²æ‰°

4. **é‡æ–°å®‰è£…**
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…
pip uninstall -y -r requirements.txt
pip install -r requirements.txt
```

---

## å¿«é€Ÿè¯Šæ–­æ¸…å•

è¿è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

```bash
# 1. Python ç‰ˆæœ¬
python --version  # åº”è¯¥ >= 3.8

# 2. ä¾èµ–åŒ…
pip list | grep -E "fastapi|uvicorn|openai|sqlalchemy"

# 3. ç¯å¢ƒå˜é‡
cat .env  # Linux/Mac
type .env  # Windows

# 4. ç›®å½•ç»“æ„
ls -la  # Linux/Mac
dir  # Windows

# 5. ç«¯å£å ç”¨
netstat -an | grep 8000  # Linux/Mac
netstat -an | findstr 8000  # Windows

# 6. æ–‡ä»¶æƒé™
ls -l lmarena.db  # Linux/Mac

# 7. æµ‹è¯• API
curl http://localhost:8000/health
```

---

**ç¥ä½ é¡ºåˆ©è¿è¡Œ LMArenaï¼** ğŸš€

